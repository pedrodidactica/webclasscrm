<?php
/*********************************************************************************
 * The content of this file is subject to the EMAIL Maker license.
 * ("License"); You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is IT-Solutions4You s.r.o.
 * Portions created by IT-Solutions4You s.r.o. are Copyright(C) IT-Solutions4You s.r.o.
 * All Rights Reserved.
 ********************************************************************************/
error_reporting(0);

$memory_limit = substr(ini_get("memory_limit"), 0,-1);
if($memory_limit<256){
  ini_set("memory_limit","256M");
}

global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;
$x0b="\141\x72r\x61\x79_k\x65\171s"; $x0c="\141\x72\162\141\x79\137\160\x75\x73h"; $x0d="\141\x72\162\141\171\137\x6d\145\162g\145"; $x0e="\141\162\162\x61y\x5f\163\165\x6d"; $x0f="c\141\x6c\x6c\137us\x65r\x5ffu\156c_\141rr\141\x79"; $x10="\x63\157un\x74"; $x11="da\164e"; $x12="\145x\x70l\x6f\x64\145"; $x13="\146ile\x5fe\170i\163\x74\x73"; $x14="g\154\157\x62"; $x15="\x68\164\155\154_\145n\x74\151\164\x79\137\144e\143\157\144\x65"; $x16="\151\x63o\x6e\166"; $x17="\151\x6d\160l\x6fde"; $x18="\151\x6e\137a\162\x72a\171"; $x19="\151s\137\x6e\165\155\x65\162\x69\x63"; $x1a="i\163\137o\x62\152\x65ct"; $x1b="\x6dd5"; $x1c="\x6e\1542b\x72"; $x1d="\x6eum\142e\x72_\x66or\155a\164"; $x1e="p\x72\x65\x67\x5fm\141\164\143\150\x5fal\154"; $x1f="\x72ou\x6ed"; $x20="\x72\x74\x72\x69m"; $x21="\163\x74r_\x72\145\160\x6c\x61\143\145"; $x22="\163t\162_\151r\145p\x6c\141\x63\145"; $x23="s\x74\162le\156"; $x24="\x73\x74\x72\164ol\x6f\x77\145\162"; $x25="\163tr\164o\165p\160e\162"; $x26="s\x74\x72\x70o\x73"; $x27="\163t\162\x73\164r"; $x28="\x73\x75b\163t\x72"; $x29="t\x72i\x6d"; 
class EMAILContent {private $version_type;private $license_key;private $module;private $recipient_id;private $recipient_module;private $language;private $focus;private $db;private $mod_strings;private $def_charset;private $site_url;private $decimal_point;private $thousands_separator;private $decimals;private $ignored_picklist_values=array();private $header;private $footer;private $body;private $content;private $templatename;private $type;private $replacements;private $Email_Images;private $inventory_table_array = Array("\120\165\162\x63\x68a\x73\x65\x4f\x72\144\x65r"=>"\x76tiger\x5f\x70\165\162c\150\141s\x65or\x64er", "S\x61\x6ces\x4f\x72\x64\x65\x72"=>"\166\164i\147er\x5fs\x61\x6c\x65\163\x6f\x72\x64er", "Q\165\157\164\145\x73"=>"v\164\151\x67er\x5fquot\x65\x73", "In\x76\x6fi\x63e"=>"\x76\x74i\x67\145\x72\x5f\x69n\166o\151\143\145", "\111\163\163\165\145ca\x72\x64\x73"=>"\166ti\147\145\162_i\x73s\x75\x65c\x61r\144s", "\122\x65ce\151p\x74\143a\162d\163"=>"\166\164\151\147\145r\x5f\162e\x63\x65\x69p\x74c\x61\162\144\163", "C\x72\145\144it\156ot\145"=>"\166\x74\151\x67\x65\162\x5fcr\145d\151\164\156\x6ft\145", "\x53\164\157r\x6eo\111\156\166\157\151\143\145"=>"\166\x74\x69\147e\x72_\x73t\157r\x6eo\x69\156\x76\157\x69\143\x65");private $inventory_id_array = Array("Pu\x72ch\141\x73\145O\x72d\x65\162"=>"p\165\x72\x63h\141\x73\145or\144e\x72\x69\144","S\141\x6c\145s\x4f\162\x64e\162"=>"sa\154\145s\x6f\162\x64\x65\162\x69\x64","Q\165ot\x65\163"=>"\x71uo\164\145\151d","\x49n\166\157\151\143e"=>"\151\x6e\166oi\x63\x65i\144","I\163s\x75\x65c\x61\162\144\x73"=>"i\163s\165\145\x63\141\x72\x64\x69d","\122ec\145i\x70\164\143\141r\x64s"=>"\x72e\143\x65i\x70\164c\141\x72d\151\x64","\103r\x65d\151\164not\145"=>"\143r\145di\x74\x6eo\164\145_\x69\x64","Stor\156\x6f\111\x6e\166\157\151\143\145"=>"\x73\164or\156\x6fi\x6e\x76\157\x69\x63e\137\151\x64");private $org_colsOLD = array("o\x72\147a\156i\x7a\x61\164io\x6e\156am\145" => "\103OM\x50A\x4eY\x5f\116A\115\x45","\141d\144r\145\163\x73" => "CO\x4d\120A\116\x59\x5f\101D\104R\105\x53\123","\x63it\x79" => "C\x4fM\120A\116\131_\103\111\124\x59","s\x74\141\164\x65" => "\103O\115PAN\x59_\x53\x54\101\x54\x45","co\144\x65" => "\103OM\120\x41N\x59\137\132\x49P","\x63\x6f\x75\x6e\164r\x79" => "\103\x4fM\x50\101\x4e\131\x5f\x43\117\125\x4eTR\x59","\160\x68\157\x6e\145" => "CO\x4d\120\x41\x4eY\137\120\110\x4f\116\x45","\x66\141\170" => "\103\117M\x50\101\116Y_\x46\x41\x58","\x77\x65\x62s\151\164\145" => "\x43\x4f\115\120A\x4eY\137\x57\x45\102S\111\124E","\154\x6f\x67\x6f" => "\103\117M\120A\116\131_L\x4f\x47\117", );private $org_colsNEW = array("o\x72\x67\141niz\141\x74i\x6f\x6e\156\141\x6d\145" => "c\157\155pa\156y-\x6e\141me","a\144d\162e\x73s" => "c\x6fm\x70an\x79-\x61\144\144\162\x65\x73\x73","\x63\x69\164\171" => "\143\x6f\x6d\160\x61\156\171\x2dcit\x79","s\x74a\164e" => "\x63\x6f\x6d\x70\x61\156y-st\x61\164e","\143\x6fde" => "\x63o\155\160\x61n\x79-\x7a\151\160","\x63\x6f\x75n\164r\x79" => "\143\157m\x70an\171\x2d\143\x6f\x75nt\162\x79","\x70hon\x65" => "c\x6f\x6d\x70a\156\171-\x70h\157\x6ee","\146\141\170" => "c\157\x6d\x70\141\156y\x2d\x66a\170","\167\x65b\163it\x65" => "com\x70a\x6e\171-\x77\145\142\x73\151\164e","\x6c\157g\x6f" => "co\155pan\171\x2dlog\x6f", );function __construct() {$db = "\141d\142";$mod = "e\137m\x6f\144_\163t\162\151\x6e\147s";$vcv = "\x76t\151\x67\145\x72_\143u\162re\x6et_\166\x65\162s\151\157\156";$salt = "\x73\151t\x65\x5fU\x52\x4c";$dc = "\144\145f\x61u\154\164\x5f\143\x68\141r\x73\145\x74"; global $$db, $$mod, $$e_mod, $$vcv, $$salt, $$dc;$this->site_url = $$salt; $this->db = &$$db; $this->mod_strings = $$mod;$this->def_charset = $$dc;$this->x2b();$result = $this->db->query("\x53\x45\x4c\x45C\x54\x20\x6c\x69cens\145\040F\122\x4f\x4d \166t\x69\147\145\x72_\x65\x6d\x61k\x65\x72\164\x65\x6dpl\x61t\145\x73_\x76\x65\162\163\151\x6f\x6e\x20\x57\110\105\x52E\x20\166\145r\x73\151\157\156\075'".$$vcv."'");if($this->db->query_result($result,0,"l\151\x63\145n\x73e")==$this->x27("\x50".$this->x23("pr\x6f\057".$$salt."\x2fE\115AI\114\115\141k\145\162")) && $this->license_key != '')$this->type = "\x70\x72\x6f\146\x65\x73sio\x6ea\x6c";else$this->type = "\x69\x6e\x76\x61l\151\144";$this->language = $_SESSION['authenticated_user_language']; }public function setContent($email_body, $recipientid, $recipientmodule, $pid) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  $this->recipient_id = $recipientid;$this->recipient_module = $recipientmodule;$this->body = $email_body;$this->x13();if ($pid[0] == "\155"){if ($this->recipient_id != "" && $this->recipient_id != "\060"){$pid = $this->recipient_id;}else{$pid = "";}} if ($pid != "" && $pid != "\060"){ $result = $this->db->pquery("s\145\x6c\x65\143\x74\x20se\164yp\145 \x66\162\x6fm\x20vt\x69\x67e\162\x5f\x63\x72m\145\x6e\x74\151\x74y\040\167\x68e\162e\x20\143\162m\151\144=?", array($pid));$num_rows = $this->db->num_rows($result);if ($num_rows > 0){ $this->module = $this->db->query_result($result,0,"\163\145\164\x79\160\145"); $this->focus = CRMEntity::getInstance($this->module);$this->focus->retrieve_entity_info($pid,$this->module); $this->focus->id = $pid;}}$sql = "\x53\105\114E\x43T\x20\x2a\040\106R\117\x4d\040v\x74\x69\147\145\x72_e\155\141\x6b\x65\162\x74\145m\x70\154\x61\x74\145\163_set\164i\x6eg\x73";$result = $this->db->pquery($sql, array());$data = $this->db->fetch_array($result);$this->decimal_point = $x15($data["\144\145ci\x6dal\x5fp\x6f\151\x6e\164"], ENT_QUOTES);$this->thousands_separator = $x15(($data["t\150\x6f\165\x73\141n\144\163\x5fs\x65\x70\x61\162\x61\x74or"]!="\x73\x70" ? $data["\164h\157us\x61\156\144\163\137\163e\160\x61\162\x61\164\x6f\162"] : " "), ENT_QUOTES);$this->decimals = $data["\x64e\143\151\155a\x6c\x73"];$this->language = $_SESSION['authenticated_user_language']; }public function getContent($convert_recipient = true) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; require_once("c\x6casses\057\163\151mp\154\145_ht\155\154_dom\062.\x70h\x70");$img_root = "\151\155\x67_\162\x6f\x6f\x74\x5fd\x69r\145c\164o\x72\x79";global $$img_root;if ($this->type == "p\x72of\145s\x73i\157\156\x61l") {$this->content = $this->body;$this->replacements["\046\156b\163\160\073"]="\040";$this->replacements["\043\x23\x44D-M\x4d\055\131Y\x59Y\x23#"]=$x11("\x64\x2d\155\055\x59");$this->replacements["##\104\x44.\115M\056\x59\131\131\x59\x23\x23"]=$x11("\x64\x2em.\x59");$this->replacements["#\043\x4d\115-\104\x44\055YY\131\131#\043"]=$x11("\155-\144\x2d\x59");$this->replacements["##\x59\x59\x59\131\055\x4d\x4d\055DD#\x23"]=$x11("\x59\055m-\x64");$this->replacements["#\x23\x4dM\057DD\057Y\x59Y\131##"]=$x11("m\057\x64\057Y");$this->replacements["\043\x23\104\104\057\115\x4d/Y\x59\131\x59\043#"]=$x11("\x64/m\057Y"); if ($this->module != ""){ $this->replacements['$s-'.$x24($this->module).'-crmid$']=$this->focus->id;if($this->module == "\103\x6f\156\164a\143\x74\x73"){$this->replacements['$s-contacts-imagename$']=$this->x15($this->focus->id);} $this->replacements['$USERS_IMAGENAME$']=$this->x16($this->focus->column_fields["\141\x73s\151\x67n\145d\137\x75s\145\162_\x69\x64"]); $this->replacements['$R_USERS_IMAGENAME$']=$this->x16($_SESSION["a\165t\150\x65ntic\141\164\145d\x5fu\x73er_\151\144"]); }$this->x12();$this->content = $x15($this->content,ENT_QUOTES,$this->def_charset); if ($convert_recipient && $this->recipient_id != ""){$focus_recipient = CRMEntity::getInstance($this->recipient_module);$focus_recipient->id = $this->recipient_id;$this->x1d($focus_recipient,$focus_recipient->id ,$this->recipient_module);$this->replacements["\x24".$x24($this->recipient_module)."-\143\162m\x69\144$"]=$focus_recipient->id;$this->x12();$this->x0e($this->recipient_module, $focus_recipient);}if ($this->module != ""){$this->x29();$this->x2a();$this->x0b();$this->x24();$this->x0e($this->module, $this->focus, "\x73-");$this->x0d(); if($this->focus->column_fields["\141\x73\163\x69gne\x64\x5fu\163e\x72\137\151d"]==""){$this->focus->column_fields["\x61\163\x73i\x67\x6ee\x64_\165\x73\x65\x72_\151\x64"]=$this->db->query_result($this->db->query("\123\x45\114\105CT\x20smo\x77\x6ee\162\x69d\040\106\x52\x4f\x4d \x76\164\x69\147\x65\162\137\143\162\155\145n\164\151\164\171 \x57\x48\105\122\105\040\143r\155\151\x64\x3d".$this->focus->id),0,"\163\x6d\x6f\x77\x6eeri\x64");}} $this->x0f();$this->x10(); if($x25($this->def_charset) != "\125\124\106\055\x38") {$this->content = $x16($this->def_charset,"\125T\x46\055\x38\057/\x54RA\116\x53\114\x49T",$this->content);}$this->x21();if ($convert_recipient){$this->x26();$this->x21("\137a\x66\164\145r");} if ($convert_recipient) $this->x11();}else{$this->content = "\111\x6eva\x6ci\144\040\154i\x63\x65n\163\145 \153\145y!\040\x50\154\x65a\x73e \x63\x6fntac\164 t\x68e ve\x6e\x64\157\x72 o\x66\x20\x45\x4d\x41I\114 \x4d\141k\x65\162\x2e";}return $this->content;}private function x0b() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $sql = "SE\114\x45\103\124\040\146i\x65ld\x69d\x2c \146i\145\154\144n\x61m\x65\054\x20c\x6f\x6c\x75\155n\x6e\x61\x6de, \165\151\164y\x70\x65\015
 \040\x20\x20\x20 \x20\040\x20\x20 \040\040\040FRO\115\x20\166\x74\151g\145\162\x5f\x66\151\145\x6cd\015\012\x20\x20\x20 \x20\040\040\040 \x20\040\040\040\040\x57\x48\105RE\x20t\141\x62i\x64=".getTabId($this->module)." \101N\x44\x20\050d\x69s\160l\x61\171\164\x79\x70\x65\x20\x21=\x203\x20O\122\x20\x66\x69\145\154d\151\x64 \075\x20\x36\x34\x29";$result = $this->db->query($sql);$num_rows = $this->db->num_rows($result);if ($num_rows > 0){$tacModules = array();$tac4you = $x19(getTabId("T\141\x63\x34y\157u"));if($tac4you == true) {$tacSql = "S\105\114\x45\x43\x54\x20\164\x61\x63\064\171\x6f\x75\x5f\x6dod\x75\x6c\145\x20\106\x52O\115 \166\x74\x69g\145\162\x5ft\141\143\064\x79\157\165\137\x6do\144u\154\145\x20\127\x48\105RE\x20\x70\162\145sen\143\x65\x20\x3d \x31";$tacResult = $this->db->query($tacSql);while($tacRow = $this->db->fetchByAssoc($tacResult))$tacModules[$tacRow["t\x61\143\x34\171\157u\x5fmo\144\165l\x65"]] = $tacRow["\x74\x61c\x34\x79\x6f\165\137mod\165l\145"];}$descModules = array();$desc4you = $x19(getTabId("De\163c\162\151p\x74\151\157n\1634\171\157\x75"));if($desc4you == true) {$descSql = "\123\105\x4c\x45\x43\124\x20\142\x2e\x6e\x61\155\145\x20\106\122O\x4d\040vt\151\x67\145\162_\x6ci\x6ek\x73 \101S\040\141\015
\040\040\x20\x20  \x20 \040\040\040\040 \040\x20\040\x20 \040\x20\x20\040\040\040\040IN\x4e\105R\x20\x4aOI\x4e\x20\x76tig\x65r_ta\x62\x20\101\x53 \142 \125\123I\x4eG \050\x74ab\x69d\051
\x20  \040 \x20\040 \040\x20\x20\x20\040 \x20\x20\x20\x20\040\x20\x20\040\x20\040\x20\x57\x48E\122\105\040li\156kty\x70\x65 \075\040'\104\105\124A\x49\114\x56\111\x45\x57WI\104\x47E\124'\015\012\x20\x20\x20 \x20   \040 \040 \x20 \040\040\040\040\040\x20\x20 \x20\x20\040\040\040\040\x41\x4eD\x20l\151nk\x75\x72\154\x20\x3d\040'\142\154\157c\x6b\072\057\x2fM\157\144\104\145scr\x69\160tion\1634y\157u\072\x6d\x6f\x64\165les\x2fD\x65s\x63r\x69\160\x74i\157\156s\x34y\157\x75/\115o\144\104\145s\x63\162\x69\160t\x69o\x6es4\x79\157u.p\150\160'";$descResult = $this->db->query($descSql);while($descRow = $this->db->fetchByAssoc($descResult))$descModules[$descRow["\156\141\x6d\145"]] = $descRow["\x6e\141\155\145"];}while($row = $this->db->fetch_array($result)){$columnname = $row["c\157\154\165m\156\156\x61\155\145"];$related_module = "";$fk_record = $this->focus->column_fields[$row["\x66\x69\x65\x6c\x64\156\141\155e"]];switch ($row["\x75\151\x74\171pe"]) {case "\065\x31": $related_module = "\101\143\x63\x6fun\164\163"; break;case "\x35\067": $related_module = "Co\x6e\x74\141\143\x74s"; break;case "5\x38": $related_module = "\x43\141\x6d\x70\141ig\156\163"; break;case "\065\x39": $related_module = "\120\162\x6f\144u\143\x74s"; break;case "7\063": $related_module = "A\x63\x63ou\x6e\x74\x73"; break;case "\x375": $related_module = "\x56\145n\x64\x6f\x72\163"; break;case "\x381": $related_module = "\126\x65\156\x64\157\162\x73"; break;case "\0676": $related_module = "P\157te\156\x74\x69a\x6cs"; break;case "\x37\x38": $related_module = "\x51u\157\x74\x65\x73"; break;case "\x380": $related_module = "\x53\141\154esOrder"; break;case "\x36\070":case "\x31\060": $related_module = getSalesEntityType($fk_record); break;}if ($related_module != "") {$tabid = getTabId($related_module);$field_inf = "\x5ff\151\x65l\x64\151n\146o\x5fcac\x68\145";$temp = &VTCacheUtils::$$field_inf;unset($temp[$tabid]); $focus2 = CRMEntity::getInstance($related_module);if ($fk_record != "" && $fk_record != "0") {$result_delete = $this->db->query("\x53E\x4c\105CT\x20d\x65le\x74\145\144\x20\x46R\117M\x20\x76t\151\147\145\162_\x63r\155e\x6e\164\151\164\x79\040\127\110\105\x52\105\x20c\x72\155i\144\075'".$fk_record."'\040AND\x20d\145\x6ce\x74\x65\144\075\060");if($this->db->num_rows($result_delete)>0){ $focus2->retrieve_entity_info($fk_record,$related_module); $focus2->id = $fk_record;}}$this->replacements["\044"."\162\x2d".$columnname."-".$x24($related_module)."\055c\162mid\044"]=$focus2->id; if(isset($related_module) AND $related_module == "C\x6f\x6e\x74a\x63ts"){$this->replacements["\044"."\x72"."\x2d".$columnname."\x2d\143o\156\164\141\143\x74s\055\151\x6d\141ge\x6ea\155e\x24"]=$this->x15($focus2->id); }if(isset($tacModules[$related_module])) {$tacSql = "S\x45\x4cE\103\x54\040\x74e\x78\x74\x20\106\122\x4f\x4d\x20v\164\x69g\145r_t\141\x634\171ou\x5f\164\x65x\x74s\x20W\110\105RE i\x64=\x3f";$tacResult = $this->db->pquery($tacSql, array($focus2->id));$tacText = $this->db->query_result($tacResult, 0, "\x74\x65x\x74");$this->replacements["\x24"."r\055".$columnname."\x2d".$x24($related_module)."-\164a\x63\x34y\x6fu\x24"] = $x15($tacText, ENT_QUOTES, $this->def_charset);}if(isset($descModules[$related_module])) {$descSql = "\123\x45\114\x45\103T\x20t\145\x78\x74\040F\122\117M\040\166\164\151\x67er\137\x64e\x73\143\x72\151p\164\151on\163\x34\171o\x75\137t\145\170t\163\040\x57\110\x45\122E\040\151d\x3d?";$descResult = $this->db->pquery($descSql, array($focus2->id));$descText = $this->db->query_result($descResult, 0, "\x74\145\170t");$descText = $x15($descText, ENT_QUOTES, $this->def_charset);$this->replacements["\044"."\x72-".$columnname."\055".$x24($related_module)."-d\x65\x73\143\064\171\x6f\x75$"] = $descText;} $this->x12();$this->x0e($related_module, $focus2, "r\x2d".$columnname."-"); $this->x28($related_module, $focus2, "r\x2d".$columnname."\055");unset($focus2);}if ($row["ui\164\171\160\x65"] == "\061\060" || $row["u\151\x74y\160\145"] == "\0668") {$F_Related_Modules = array(); if ($row["u\151\x74yp\x65"] == "6\x38"){$F_Related_Modules[] = "\x41\143co\165\156ts"; $F_Related_Modules[] = "\103\157n\164\x61ct\x73";}elseif ($row["\165\x69\164\171p\x65"] == "1\x30"){$fm_sql = 'select relmodule from vtiger_fieldmodulerel where fieldid=?';$fmrs=$this->db->pquery($fm_sql, array($row['fieldid']));while ($rmr=$this->db->fetch_array($fmrs)) { $F_Related_Modules[] = $rmr['relmodule'];}}foreach ($F_Related_Modules AS $related_module2) {if ($related_module2 != $related_module){$tabid2 = getTabId($related_module2);$field_inf = "\x5f\146\x69\145\x6cd\x69\156\146o\x5f\143a\143\150e";$temp = &VTCacheUtils::$$field_inf;unset($temp[$tabid2]);$focus3 = CRMEntity::getInstance($related_module2);$this->replacements["\x24"."\162\055".$columnname."\x2d".$x24($related_module2)."\055\143\x72m\x69\144$"]=$focus3->id;$this->x0e($related_module2, $focus3, "\x72\055".$columnname."\x2d");unset($focus3);}}}}}}private function x0c() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; require_once("\x63la\163\x73e\x73\x2fs\x69\x6dpl\145\137\150\x74\155\x6c\137\x64\157\x6d2\x2ep\x68p");$html = str_get_html2($this->content);foreach($html->find("\164\x64") as $td){if($x29($td->plaintext) == "#\x50\x52\x4f\x44U\x43\124\x42\114\117\103_S\x54A\x52T\x23") $td->parent->outertext = "#\x50\122\117\x44\125\x43\124\102\x4c\117C\x5f\x53\124A\x52T#"; if($x29($td->plaintext) == "#\120\x52\117\x44\x55\x43T\x42\114\117C_\105N\x44\x23") $td->parent->outertext = "\043\x50\122O\x44\125C\x54\x42\114O\103_\x45\x4eD#";}$this->content=$html->save();} private function x0d() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  $query = "\163\145\x6c\145c\164\x20\052\040from\040\166\x74\x69\147\145\x72\137\x69\x6eve\156\x74\157\162y\x70\x72o\x64u\143\164r\x65\x6c \x77\150\145re \x69\x64\075?";$result = $this->db->pquery($query, array($this->focus->id));$num_rows=$this->db->num_rows($result); if ($num_rows > 0){ $this->x28($this->module, $this->focus, "s-");$Products = $this->x28($this->module, $this->focus); $var_array = array();if($x26($this->content,"\043"."\120\x52\x4f\x44UC\x54B\114\117\103\137\x53\124AR\124"."\043") !== false && $x26($this->content,"\043"."P\122\x4f\104UC\124\102L\x4f\103\x5f\105\x4eD"."#") !== false){$this->x0c();$ExplodedPdf = array();$Exploded = $x12("#"."\120\122\117\x44\x55\x43TB\x4c\117C_\x53TAR\124"."\x23",$this->content);$ExplodedPdf[] = $Exploded[0];for($iterator=1;$iterator<$x10($Exploded);$iterator++){$SubExploded = $x12("\x23"."PRO\104U\103\x54\x42\x4c\117\x43\x5fE\116\104"."\x23",$Exploded[$iterator]);foreach($SubExploded as $part)$ExplodedPdf[] = $part;$highestpartid = $iterator*2-1;$ProductParts[$highestpartid]=$ExplodedPdf[$highestpartid];$ExplodedPdf[$highestpartid]="";} foreach ($Products["P"] AS $Product_i => $Product_Details) {foreach($ProductParts as $productpartid=>$productparttext){foreach ($Product_Details AS $coll => $value) {$productparttext = $x21("$".$x25($coll)."$",$value,$productparttext);$productparttext = $x21("$".$x24($coll)."$",$value,$productparttext);}$ExplodedPdf[$productpartid].=$productparttext;}}$this->content = $x17("",$ExplodedPdf);} }}private function x0e($emodule, $efocus, $related = "", $is_inventory = false) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $related_fieldnames = array("\x72e\154\141\164\x65\144\137\164\x6f","\x72\145la\164ed\164\x6f","\160\141\162\145n\x74\137\151\144","\x70\x61\162\x65nt\x69\144","\160\162\157\144u\143\164_\151\x64","p\162\x6f\144\165c\x74i\144","ser\x76\151ce\137\x69d","\163e\162\166\151\x63\145\x69\144","\x76en\x64o\162_\151\x64","\160r\x6fd\x75\x63\164","a\x63c\157\165\x6e\x74","\151\x6evo\x69ce\151d","l\151n\x6b\x74\x6f\x61c\143oun\x74\163\x63o\156\x74\x61\x63\164\x73","\160\162o\x6a\x65ct\x69\144","\x73\143_\162\x65\x6ca\164\x65d\137\x74\x6f");if($is_inventory)$inventory_content=array();$tabid = getTabid($emodule);$Checkboxes = array();$Picklists = array();$Textareas = array();$Datefields = array();$Multipicklists = array();$NumbersField = array();$sql = "\x53\105L\105C\x54 f\151e\154dn\x61m\145\x2c\x20\165\x69t\171p\145 \106\x52\x4f\x4d\x20\x76ti\x67e\x72_\x66\151e\x6c\x64\040\x57H\105\122E \x74ab\151\x64\x20\075\040'".$tabid."'";$result = $this->db->query($sql);while($row = $this->db->fetchByAssoc($result)){if ($row["\x75\x69\164\171\x70\x65"] == "1\071" || $row["u\151\x74\x79\160\x65"] == "\062\060" || $row["\x75\x69\164\171\x70\145"] == "21" || $row["\x75\x69\164\x79\x70\145"] == "2\x34")$Textareas[] = $row["\146\x69\x65\154\144n\x61\x6d\145"];elseif ($row["u\x69\x74\171p\x65"] == "\065" || $row["\165\151\164\x79\x70e"] == "23" || $row["u\151\x74\x79\x70\145"] == "7\x30")$Datefields[] = $row["\x66\x69eld\156\141\155\x65"];elseif ($row["\x75it\171pe"] == "\0615" || $row["f\x69\x65l\x64\156\x61m\x65"] == "\x73\141\154\165\x74ati\x6fntyp\x65")$Picklists[] = $row["fi\145\x6c\144\x6ea\155e"];elseif ($row["\x75i\164\171\160\x65"] == "5\x36")$Checkboxes[] = $row["\x66i\x65\x6cd\x6e\141\155\x65"];elseif ($row["\x75\151\x74\171\160\x65"] == "\x33\063")$Multipicklists[] = $row["f\x69e\x6c\x64\x6e\141\x6d\145"];elseif ($row["\165i\164ype"] == "\x37\x31")$NumbersField[] = $row["\146\151\145l\144\x6e\141\x6d\x65"];}foreach ($efocus->column_fields as $fieldname => $value){if ($fieldname == "a\163s\x69g\156\145\x64\x5f\x75\163\145r\x5f\x69\x64")$value = $this->x17($value);elseif($fieldname == "\141\x63\143\x6f\x75\x6e\x74_\151\x64") { $value = getAccountName($value);}elseif($fieldname == "\160\157\x74\145\156\164\x69\x61l\x5fi\x64")$value = getPotentialName($value);elseif($fieldname == "c\x6fn\x74ac\x74\x5fid")$value = getContactName($value);elseif($fieldname == "qu\x6f\164e_\151d")$value = getQuoteName($value);elseif($fieldname == "\163a\154es\157\x72d\145\x72\x5f\x69d")$value = getSoName($value);elseif($fieldname == "\143\141\155\x70a\151\x67nid")$value = getCampaignName($value);elseif($fieldname == "\164\x65\162\x6ds\137c\157\156d\151t\x69\x6f\156\x73")$value = $this->x1e($value);elseif($fieldname == "\x63\157\x6dm\x65n\x74\x73")$value = $this->x1f($efocus);elseif($fieldname == "f\x6fl\x64\145\x72\x69\144")$value = $this->x20($value);elseif($x18($fieldname, $related_fieldnames)) {if ($value != "") {$parent_module = getSalesEntityType($value);$displayValueArray = getEntityName($parent_module, $value);if(!empty($displayValueArray)) {foreach($displayValueArray as $key=>$p_value) {$value = $p_value;}}if($fieldname=="\x69n\166\x6f\x69\x63\145\x69\144" && $value=="\060")$value="";}}if($x18($fieldname, $Datefields))$value = getValidDisplayDate($value);elseif($x18($fieldname, $Picklists)) {if(!$x18($x29($value), $this->ignored_picklist_values))$value = $this->x19($value,$emodule);else$value = "";}elseif($x18($fieldname, $Checkboxes)) {$email_app_strings = return_application_language($this->language);if($value == 1)$value = $email_app_strings["\171es"];else$value = $email_app_strings["\156o"];} elseif($x18($fieldname, $Textareas)) {$value = $x1c($value); $value = $x15($value,ENT_QUOTES,$this->def_charset);} elseif($x18($fieldname, $Multipicklists)) $value = $x22(' |##| ',', ',$value);elseif($x18($fieldname, $NumbersField))$value = $this->x1c($value); if ($is_inventory)$inventory_content[$x24($emodule."\055".$fieldname)] = $value;else$this->replacements["\x24".$related.$x24($emodule."\055".$fieldname)."\044"]=$value;} if($is_inventory)return $inventory_content;else$this->x12();}private function x0f() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $cur_usr = "c\x75\x72\162\x65nt\x5f\x75\163\x65r";$root_dir = "\162oo\164\x5fd\x69\162e\143\x74\157r\171";global $$cur_usr,$$root_dir; $sql = "\x53\x45\x4c\105\x43\x54\040*\x20F\x52\x4fM \166ti\147\x65\162\137\x6frgan\x69\172\141\164ion\144\145\164\141i\x6c\163";$result = $this->db->query($sql);$Org_Details = $this->db->fetchByAssoc($result, 1);foreach ($Org_Details AS $coll => $value) {if ($coll == "\x6c\x6f\x67\157")$value = "<i\x6d\x67\040\x73\162c='".$$root_dir."t\145st\x2f\x6cogo\x2f".$Org_Details["\154o\x67\157\156\141\155e"]."'>";$this->replacements["\044".$this->org_colsOLD[$coll]."$"] = $value;$this->replacements["\x24".$this->org_colsNEW[$coll]."$"] = $value;} $sql = "S\105\x4cEC\x54\040\x74\x61nd\x63 \x46\122\x4f\115\040\166\164i\x67e\x72\137\x69n\x76e\x6e\x74\x6f\162\x79\x5ft\x61\156\x64\x63\x20\127H\x45\122E\040\164\171pe\040=\x20'\111\x6e\166\145nt\157\162\171'";$tandc = $this->db->query_result($this->db->query($sql), 0, "\164\x61\x6ed\x63");$this->replacements["\044"."t\x65\x72\155s\x2d\141\x6e\x64\055con\144\151tions\044"] = $x1c($tandc);$this->x12();if ($this->module != ""){$focus_user = CRMEntity::getInstance("\x55s\x65r\163");$focus_user->id = $this->focus->column_fields["\141\163\163\151\147\156e\144_\165s\x65r\x5fi\x64"];$this->x1d($focus_user,$focus_user->id ,"\125\163e\x72\x73");$this->x0e("U\163\x65\x72\163", $focus_user, "\x73-");}$this->x0e("\x55\163\x65r\x73", $$cur_usr, "\154\x2d");}private function x10(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  $app_lang = return_application_language($this->language);if($x26($this->content, "\x25\107_")!==false){ foreach($app_lang as $key=>$value){ $this->replacements["%\107\137".$key."\045"] = $value; } }if ($this->module != "") { $mod_lang = return_specified_module_language($this->language,$this->module); if($x26($this->content, "\045\115\137")!==false){ foreach($mod_lang as $key=>$value){ $this->replacements["%\115_".$key."%"] = $value; } } } $this->x12();}private function x11(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $salt = "\x73\x69\x74\145\x5f\x55R\114"; global $$salt;$surl = $$salt; require_once("clas\x73\145s\x2f\x73\x69m\x70\x6c\x65\137h\164\x6d\x6c\x5fdom\x32\x2ep\x68\x70");$html = str_get_html2($this->content);if($surl[$x23($surl) - 1] != "\057")$surl = $surl."/";$i = 1;foreach($html->find("\151\155g") as $img){if($x26($img->src, $surl) === 0) {$newPath = $x21($surl, "", $img->src);}else{$newPath = $img->src;}if($x13($newPath)){$img->src = "c\x69d\072\x69\155\141\147\145".$i;$Parts = $x12("\x2e",$newPath);$img_type = $Parts[$x10($Parts) - 1];$this->Email_Images["\x69\155a\x67e".$i] = array("n\141\155\x65"=>"\151\155\x61g\x65".$i."\056".$img_type,"\x70a\164\150"=> $newPath);$i++; }}foreach($html->find('[background]') as $img){if($x26($img->background, $surl) === 0) {$newPath = $x21($surl, "", $img->background);if($x13($newPath)){$img->background = "\x63\x69\144\x3aim\141\147e".$i;$Parts = $x12(".",$newPath);$img_type = $Parts[$x10($Parts) - 1];$this->Email_Images["\x69\155\141\x67\145".$i] = array("\156\141\155\145"=>"\151\x6d\x61g\145".$i."\x2e".$img_type,"p\x61th"=> $newPath);$i++; }}}$this->content=$html->save();}public function getEmailImages($convert_recipient = true) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; return $this->Email_Images;}private function x12() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if(!empty($this->replacements)){ $this->content = $x21($x0b($this->replacements), $this->replacements, $this->content);$this->replacements = array();}}private function x13() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $sql = "\x53E\x4c\105\x43T\040va\x6c\x75\145 FR\117\115\x20vtige\162\x5f\145\x6da\153\145\162\x74\x65mplate\x73\137\151g\156o\162ep\151c\x6b\x6c\x69\x73t\x76\141\x6c\x75\145s";$result = $this->db->query($sql);while($row = $this->db->fetchByAssoc($result)) {$this->ignored_picklist_values[] = $row["\x76\x61l\x75\x65"];}}private function x14($parent_module,$parent_focus) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $taxtype = $this->x1b($parent_module,$parent_focus);$currencytype = $this->x1a($parent_module,$parent_focus);$query="s\145l\145\x63t\040\143\x61\x73e\040\167\x68\x65\156\040\166t\151ge\162_\x70r\157\x64\x75\143\x74\x73\056p\x72o\x64\165\143\164\x69\x64\040\x21=\040''\x20\164h\x65\156\x20vt\151\x67e\162\x5f\x70\162\157\x64\165c\164s\056p\162\x6fd\165\x63tna\x6de \145l\x73\145\040v\x74i\147\145\x72\137se\x72\166i\143\x65\x2es\145\x72vi\143e\x6e\141\x6d\x65\040end\x20\x61\163\040p\162\157\x64\x75\143t\156\141\155\x65\x2c" ." \143\x61\x73e\040\167\150e\x6e\x20v\164i\147\145r\137\160\x72\157\x64\165\x63\164\x73.\x70rodu\143tid\040!\075\x20'' \164h\145\x6e\040vt\x69\147\x65r\x5f\x70\x72o\x64\x75\143t\x73\x2e\160\x72o\x64u\143\x74id\040el\x73\x65 v\x74\x69\147\145\x72\137s\145rv\x69\x63e\x2e\x73\145r\166i\x63e\151\x64\040\x65\x6e\144\040\141\x73\x20\160\x73i\x64\054" ."\x20\x63as\145\x20\x77\150\x65n\x20v\x74ig\x65\162_\x70r\157\x64\165\143\x74s\056\160r\x6f\x64u\143t\151\x64 \x21=\x20''\x20\164\150\x65n\040v\164\x69\x67e\162\137p\x72\x6f\x64u\x63\164\163\056p\x72\157du\x63\x74\137\x6eo \145l\x73\145 v\x74\x69\147e\162\x5f\x73e\x72\x76i\143\x65\056s\x65\162\166ice_n\x6f\040\x65nd\x20\141\x73\x20\x70\163\x6e\x6f\x2c" ."\x20\143\x61se wh\x65\156\040\x76\x74\x69g\x65r\137p\x72\157duc\164s\x2e\160\162\x6f\x64\165\143\164\x69\x64\x20!\075\x20'' \x74\150e\x6e\x20'\x50\x72\x6f\144\x75\x63\x74\x73'\x20\x65\x6cs\145\x20'\x53e\x72v\x69\143\x65\x73'\040\145nd\x20\x61\x73\x20e\x6e\164i\164\171\164\171p\145\x2c" ." \143a\163\x65 \167\150\x65\156 \166t\x69\x67er_\160\162o\144\x75\x63\164\163\056\x70\x72o\x64\165\143\164id\x20\041= '' then \166\164\151ge\162\x5f\x70\x72o\144u\143\164\163.\165ni\164\x5fp\x72\x69c\x65 e\x6c\163\x65\x20\x76\x74\151g\x65\x72\x5fse\162\x76i\143e\056un\x69\164_\x70r\151\x63\x65 \145\156d\040\x61\x73 \x75\156\x69t_\x70\x72i\x63\x65\054" ." c\141s\x65\040\x77\150\x65\x6e\x20\166\164\x69g\x65\162_\x70r\x6fd\x75\x63\x74\163\056p\x72o\x64u\x63\x74\x69\144\x20\041= '' t\150en\040v\164i\147\x65\162\137\160r\x6f\144\x75\x63t\x73\056\x75\x73a\x67\x65un\151\x74\040\145ls\145\x20\x76t\x69\x67\x65r\x5f\163e\162\166i\x63\x65.s\145r\166\x69\x63\145\x5f\165\163\x61\x67\x65\165\x6ei\164\040en\144\x20\141\163\x20u\x73\x61ge\x75\x6ei\x74\054" ." \x63a\163\145 \167\150\x65\156\040\x76\164\151\147er\x5f\160\162\157\x64uc\164\x73\x2epr\157\144uc\164\151d != ''\040t\150\x65n v\164i\147\145r\x5f\160r\x6f\x64\165ct\163\x2e\161t\171\137\160\145\162_\x75\x6eit\x20\x65\x6cse\x20\166\x74\151\x67\145r\137\x73e\162\x76\x69\143e\x2e\161\164y_\x70\x65r\x5f\165\156\x69t\x20\145n\x64\x20as\040\x71\164y\137\160e\162_\165\x6e\x69t\054" ."\x20\x63\141\163e\040\167h\145n \x76\164\151\147\x65\x72\x5f\x70\162o\144\165\143t\163\x2e\160\162o\x64\165\143\x74\x69\144\x20!= ''\040\164h\x65\156\x20vtig\x65\x72\x5f\x70\162\x6f\144u\143ts\056\161\164\171\151\156\x73\x74\x6f\143k\040\x65\x6c\163e\x20'\x4e\101'\040en\x64\x20as\040\161\164\x79in\163t\157ck\054" ." \143\141\163\x65 \167h\x65\x6e\040vtige\162_\160r\157\x64\x75\143\164\163\056\x70r\x6fd\x75\x63t\151\144\040\x21\075\040''\040\164\150\x65n c\061.des\x63\x72\x69\160tion\040\145l\163\x65 \1432.d\145s\x63\x72\151p\x74io\x6e\x20\x65\156\144\040\141s\x20p\163\x64\x65s\143\x72\x69\160\164io\156,\040v\x74\x69\x67\145\162\137i\x6e\166e\x6e\x74\157\162\171\160\x72od\x75ctre\x6c\x2e*\040" ." \x66r\x6f\155 v\164\x69\x67\145r_in\166\x65\156\x74\157\x72\171\160\162o\144\165\x63\x74re\x6c" ."\x20l\145\146t \152\157\x69\x6e \166ti\147\145r_\160\x72\157\x64u\x63t\x73\040o\x6e\040\166\164\151g\x65r_\x70\x72\x6fd\165\143t\163\056p\162\157\x64u\143\164i\x64\075\x76\164\x69g\x65\x72_\x69\156\166e\156t\157r\x79\x70\x72\157\144u\143tre\x6c\056p\162\x6fd\x75cti\x64\x20" ."\040\154e\146t j\x6f\151\x6e\x20v\164ige\162\x5f\143\162me\x6e\164\x69ty a\x73 \x631\x20on\x20c\061.\x63\162\x6d\x69\x64\x20\x3d\x20\166\164\x69\147\145\162\x5fp\162\157\x64\165\x63t\163\x2eprod\x75\x63\164\x69d\x20" ."\040\x6c\x65\x66\164\x20\x6a\157i\156\x20\x76\x74i\x67\145\162\x5fs\145rv\151\x63e\040o\156\x20\166t\x69\x67\145\x72\x5fs\x65r\166\x69\143\145.s\145r\166\x69ceid\075\166\x74\151g\145\x72\x5f\x69\x6e\x76\x65\156t\157\162y\160\162oduct\162e\154\x2e\x70\162\x6f\144u\143t\151d " ."\040\x6c\x65\x66t\x20\x6a\x6f\151\x6e\040\x76ti\x67\x65\x72_\143rme\x6e\164\x69\164y a\163 \x63\x32 \x6fn \143\x32\x2ec\162\x6di\x64\x20= \x76tig\x65\162\x5fs\x65rv\x69\x63e.\163e\162vi\x63\x65\151\144\040" ." \x77\x68\x65\162\x65\040\x69\x64=\x3f\x20\x4f\x52\104\105R\x20B\x59 \x73e\x71\x75\x65\156c\x65\x5fn\x6f";$result = $this->db->pquery($query, array($parent_focus->id));$num_rows=$this->db->num_rows($result);$netTotal = "\060\x2e\x30\060"; $totalAfterDiscount_subtotal=0;$total_subtotal=0;$totalsum_subtotal=0; $Total_Tax_Values = array();for($i=1;$i<=$num_rows;$i++){$sub_prod_query = $this->db->pquery("SE\114\105\x43T\x20\160\162\157\144\x75\x63t\151\144 \146\x72\157m v\164i\x67\145r_\151\156v\145\156t\157\x72y\x73\165bp\x72odu\x63t\x72\x65\154\x20W\110\x45\122\x45\040i\144\x3d\077\040A\116D \163e\x71\x75\145nce_\156o=\x3f",array($parent_focus->id,$i));$subprodname_str='';if($this->db->num_rows($sub_prod_query)>0){for($j=0;$j<$this->db->num_rows($sub_prod_query);$j++){$sprod_id = $this->db->query_result($sub_prod_query,$j,"\x70r\157duc\x74\151\x64");$sprod_name = getProductName($sprod_id);$str_sep = "";if($j>0) $str_sep = ":";$subprodname_str .= $str_sep." \055\040".$sprod_name;}}$subprodname_str = $x21("\072","\x3c\x62r\x3e",$subprodname_str);$psid = $this->db->query_result($result,$i-1,"\160s\151\144");$psno = $this->db->query_result($result,$i-1,"\x70\x73\156\x6f");$productid=$this->db->query_result($result,$i-1,"\160r\157\144\x75\x63\x74\x69d");$entitytype=$this->db->query_result($result,$i-1,"\x65n\164\x69t\x79t\x79\x70e");$producttitle = $productname= $this->db->query_result($result,$i-1,"\160r\x6fd\x75\x63tna\155\x65");if($subprodname_str!="") $productname .= "\x3cb\x72/>\x3c\163\x70a\x6e\x20\163\x74\171\x6c\145\x3d'\143olo\162\x3a\x23\1030\103\060\x430\073\146\157nt-\x73\x74y\154\145\072\151t\141\x6ci\x63\x3b'\x3e".$subprodname_str."<\057\163\160a\x6e\076";$comment=$this->db->query_result($result,$i-1,"\x63\x6f\x6d\155en\x74");$psdescription =$this->db->query_result($result,$i-1,"\160\163d\145\163\x63ripti\x6f\156");$inventory_prodrel_desc = $this->db->query_result($result,$i-1,"d\145\x73c\162\151\160\x74\x69\157n");$qtyinstock=$this->db->query_result($result,$i-1,"\x71\164\x79\x69n\163to\x63\153");$qty=$this->db->query_result($result,$i-1,"q\165\141nt\151\164\171");$qty_per_unit=$this->db->query_result($result,$i-1,"\x71\x74\171_p\x65\162\x5f\x75ni\x74");$usageunit=$this->db->query_result($result,$i-1,"\x75\x73a\x67e\x75\156\x69\164");$unitprice=$this->db->query_result($result,$i-1,"\165n\x69\164\x5fp\x72i\x63\145");$listprice=$this->db->query_result($result,$i-1,"\154\151\x73\x74pr\151\x63e");$total = $qty*$listprice; $discount_percent=$this->db->query_result($result,$i-1,"d\151\163\x63ou\x6e\x74_\x70\145rc\x65\156t");$discount_amount=$this->db->query_result($result,$i-1,"d\x69\163c\x6f\165\156\164\137am\x6f\x75\156t");$totalAfterDiscount = $total;$productDiscount = "\060\x2e\0600";$productDiscountPercent = "";if($discount_percent != "N\x55\114L" && $discount_percent != "") {$productDiscount = $total*$discount_percent/100;$totalAfterDiscount = $total-$productDiscount; $productDiscountPercent=$discount_percent;}elseif($discount_amount != "\116\125\114L" && $discount_amount != "") {$productDiscount = $discount_amount;$totalAfterDiscount = $total-$productDiscount;} $netprice = $totalAfterDiscount; if($taxtype == "\151\x6e\x64\151v\151d\x75\141\x6c") {$taxtotal = "0.\0600";$tax_info_message = $this->mod_strings["\x4c\102\x4c\137\x54\117\124\x41\x4c\x5f\101FTE\x52_\x44\x49S\103\x4f\125N\x54"]." =\x20$totalAfterDiscount \\\156";$tax_details = getTaxDetailsForProduct($productid,"\x61\154\x6c");$Tax_Values = array();for($tax_count=0;$tax_count<$x10($tax_details);$tax_count++) {$tax_name = $tax_details[$tax_count]["\x74\141\170\156am\x65"];$tax_label = $tax_details[$tax_count]["\164\141xl\141\142el"];$tax_value = getInventoryProductTaxValue($parent_focus->id, $productid, $tax_name);$individual_taxamount = $totalAfterDiscount*$tax_value/100;$taxtotal = $taxtotal + $individual_taxamount;if ($tax_name != "" && $tax_value > 0){ $vatblock[$tax_name."\055".$tax_value]["\x6c\141\x62\145l"] = $tax_label;$vatblock[$tax_name."\055".$tax_value]["n\x65\x74t\157"] += $totalAfterDiscount; $vatblock[$tax_name."-".$tax_value]["\x76at"] += $x1f($individual_taxamount,$this->decimals);$vatblock[$tax_name."\x2d".$tax_value]["v\141\154\x75\145"] = $tax_value;$x0c($Tax_Values, $tax_value);$x0c($Total_Tax_Values, $tax_value);}$netprice = $netprice + $taxtotal;} if ($x10($Tax_Values) > 0){ $tax_avg_value = $x0e($Tax_Values);}else{ $tax_avg_value = "\060.0\x30";} $Details["\x50"][$i]["\x50\x52OD\x55CTV\x41TP\x45\x52\103\105\x4eT"] = $this->x1c($tax_avg_value);$Details["P"][$i]["\120\122\117D\x55\x43T\x56\101\124\123\125M"] = $this->x1c($taxtotal);}if ($entitytype == "\120\162o\x64uc\x74\163"){ $Details["P"][$i]["\x50\x52\x4f\104UCT\123\137\x43\122M\x49D"] = $psid; $Details["\120"][$i]["\x53\105\x52\126\x49\103\105\123\x5f\103\122M\x49\104"] = "";}else{ $Details["\x50"][$i]["P\x52ODU\x43\124\x53\137\x43\x52\x4d\111\104"] = ""; $Details["\x50"][$i]["S\x45R\126\111\103E\123_\x43RM\x49D"] = $psid;}$Details["\x50"][$i]["\x50S\x5fC\122\x4d\111\104"] = $psid;$Details["\120"][$i]["P\123\x5f\x4eO"] = $psno;if($comment!=""){$comment = $x21("\\n", "<\x62\x72>", $x1c($comment)); $comment = $x15($comment,ENT_QUOTES,$this->def_charset);$productname .= "\x3cb\162\040\057\x3e<\163ma\x6c\x6c\x3e".$comment."<\057s\x6d\141l\x6c>";}$Details["\120"][$i]["P\x52\x4fDUC\x54\x4e\101\x4d\105"] = $productname;$Details["P"][$i]["\120\122OD\125\x43\124\x54\111TL\105"] = $producttitle;$psdescription = $x21("\\\156", "<\x62\x72\x3e", $x1c($psdescription));$Details["\120"][$i]["\x50R\117\104U\103\124D\x45S\103\x52\111P\124\111\117\x4e"] = $x15($psdescription,ENT_QUOTES,$this->def_charset);$Details["\120"][$i]["\120ROD\125\103\124\105\104I\124\104E\x53\x43\x52I\x50\x54\x49\x4fN"] = $comment;$inventory_prodrel_desc = $x21("\\\156", "\074\142\162\076", $x1c($inventory_prodrel_desc)); $Details["\x50"][$i]["\103\x52MN\x4fW\120R\x4f\x44U\103\x54D\x45\x53\103R\x49\x50\124\x49O\x4e"] = $x15($inventory_prodrel_desc,ENT_QUOTES,$this->def_charset);$Details["P"][$i]["\x50RODUCT\x4c\111S\124P\x52\x49\103\105"] = $this->x1c($listprice);$Details["\120"][$i]["\120\122O\x44\125\103TT\117\x54A\x4c"] = $this->x1c($total);$Details["P"][$i]["\120\x52\117\104UC\124QUA\x4e\124\111T\x59"] = $this->x1c($qty);$Details["P"][$i]["\x50\x52\117\104U\x43T\121\x49\116S\x54\x4f\103\x4b"] = $this->x1c($qtyinstock); $Details["\x50"][$i]["\120\x52\117DU\x43\x54P\122\111\103E"] = $this->x1c($unitprice); $Details["P"][$i]["PR\117\x44\125\x43\x54\120OS\x49\124\x49O\116"] = $i;$Details["P"][$i]["\120RO\x44\x55\103\x54QT\x59\x50\x45\122\125\116\111\x54"] = $this->x1c($qty_per_unit); $Details["\120"][$i]["P\122\117\104\125\103\x54\125S\101\x47\x45U\116\111T"] = $this->x19($usageunit,"\x50\162\157\144\165\143t\x73\x2f\123e\162v\151\143\x65\163");$Details["\x50"][$i]["\120RO\104\x55\x43\124D\111\x53\x43O\x55N\124"] = $this->x1c($productDiscount);$Details["\x50"][$i]["\x50RO\x44\x55\x43\x54D\111\123\x43OU\x4eTPER\x43EN\x54"] = $this->x1c($productDiscountPercent);$Details["P"][$i]["PROD\x55\x43\x54\x53\124OTA\x4cA\106T\x45\x52\104\111\x53\x43\x4f\125\x4e\x54\x53\x55\115"] = $totalAfterDiscount; $Details["\120"][$i]["\x50RO\x44\125C\x54\123T\117T\101L\x41\x46T\x45\122\x44\x49\x53\103O\x55\116\124"] = $this->x1c($totalAfterDiscount);$Details["\120"][$i]["PR\117\x44U\103T\124OT\101L\123U\x4d"] = $this->x1c($totalAfterDiscount+$taxtotal); $totalAfterDiscount_subtotal += $totalAfterDiscount;$total_subtotal += $total;$totalsum_subtotal+= $totalAfterDiscount+$taxtotal;$Details["\120"][$i]["\x50\122O\x44U\103\x54\123TO\124\101\114\x41\106T\105\x52\104\x49\x53\103\117\125\x4e\x54\137\123\125\102\x54O\x54\x41\x4c"] = $this->x1c($totalAfterDiscount_subtotal);$Details["\120"][$i]["\x50\122\x4f\x44\125C\124\x54O\x54\101\x4c\x5fSUB\x54OT\x41\114"] = $this->x1c($total_subtotal);$Details["\120"][$i]["\x50R\x4f\x44\x55C\124\124O\x54\x41\114\123\125\115\x5f\x53\125\x42\124\x4f\124\101L"] = $this->x1c($totalsum_subtotal); $sequence = $this->db->query_result($result,$i-1,"\x73\x65\161\165\145\x6e\x63\145_\156o");$Details["\x50"][$i]["PR\117\x44\125C\x54S\105Q\125ENC\105"] = $sequence;if(isset($images[$productid."_".$sequence])){$width="";$height="";if($images[$productid."_".$sequence]["\x77\151d\x74h"]>0)$width="\x20w\151\144\164\150\x3d'".$images[$productid."\x5f".$sequence]["w\151d\x74\x68"]."'\040";if($images[$productid."\137".$sequence]["\150e\151gh\x74"]>0)$height="\x20\150\145\151\147\150t\075'".$images[$productid."\x5f".$sequence]["he\151\147h\164"]."'\x20";$Details["P"][$i]["PROD\125C\x54\123\x5fI\x4dA\x47\x45N\101M\x45"] = "\x3c\x69\x6d\x67\x20\163\162\143\x3d'".$this->site_url."\x2f".$images[$productid."_".$sequence]["\x73r\143"]."'\040".$width.$height."\x2f>";} $focus_p = CRMEntity::getInstance("\120r\157\x64\x75\x63\x74\x73");if ($entitytype == "P\x72\x6f\144\x75\x63ts" && $psid != "") {$focus_p->id = $psid;$this->x1d($focus_p,$psid,"\x50\x72\x6fd\x75\x63ts"); }$Array_P = $this->x0e("\x50\162o\144u\143\x74s", $focus_p, "", true);$Details["\120"][$i] = $x0d($Array_P,$Details["P"][$i]);unset($focus_p);$focus_s = CRMEntity::getInstance("Ser\x76\x69c\145\x73");if ($entitytype == "S\145\x72vic\x65s" && $psid != "") {$focus_s->id = $psid;$this->x1d($focus_s,$psid,"S\145rv\x69\143e\163"); }$Array_S = $this->x0e("Ser\166\x69\143\x65s", $focus_s, "", true);$Details["P"][$i] = $x0d($Array_S,$Details["\x50"][$i]);unset($focus_s); $sumwithoutvat += $totalAfterDiscount;$netTotal = $netTotal + $netprice;} $finalDiscount = "\060\056\x300";$final_discount_info = "\060";$finalDiscountPercent=""; if($parent_focus->column_fields["h\x64\x6e\x44\151\163\x63\x6f\165\x6e\164Pe\x72\143\x65\156\164"] != "\x30") {$finalDiscount = ($netTotal*$parent_focus->column_fields["\150\144\156\104\151sco\x75n\x74\x50er\143\x65\x6e\x74"]/100);$finalDiscountPercent = $parent_focus->column_fields["\150d\x6e\x44i\163co\165nt\x50\x65\x72c\145\x6e\164"];}elseif($parent_focus->column_fields["\150\144n\x44\151s\143\x6f\x75\156\x74\x41m\157\x75\156t"] != "0") {$finalDiscount = $parent_focus->column_fields["h\x64\x6eD\151\x73\143ou\x6e\164\101\155o\165\x6e\x74"];} $taxtotal = "0\056\x30\x30";if($taxtype == "\147\x72oup") {$final_totalAfterDiscount = $netTotal - $finalDiscount;$tax_details = getAllTaxes("\x61v\141\x69\x6c\x61\x62\x6ce","","\x65di\x74",$parent_focus->id);for($tax_count=0;$tax_count<$x10($tax_details);$tax_count++) {$tax_name = $tax_details[$tax_count]["\x74\x61xn\141\155\x65"];$tax_label = $tax_details[$tax_count]["\164\141\170\x6c\141\x62\145\154"];$tax_value = $this->db->query_result($result,0,$tax_name);if($tax_value == "" || $tax_value == "\116\x55\x4c\114")$tax_value = "\060\0560\060";$taxamount = ($netTotal-$finalDiscount)*$tax_value/100;$taxtotal = $taxtotal + $taxamount;if ($tax_name != "" && $tax_value > 0){ $vatblock[$tax_name]["la\142el"] = $tax_label;$vatblock[$tax_name]["n\145\x74\164o"] = $final_totalAfterDiscount; $vatblock[$tax_name]["va\164"] += $taxamount; $vatblock[$tax_name]["v\141\x6c\x75\x65"] = $tax_value; } $total_vat_percent += $tax_value;}$vat_value = $taxtotal; foreach ($Details["\x50"] as $keyP=>$valueP) {$productvatsum = ($Details["\x50"][$keyP]["\120R\117\104U\103TS\x54\x4f\x54\101L\x41\x46\124\x45R\104\111\123CO\x55\x4e\x54\123UM"]*$total_vat_percent)/100;$producttotalsum = $Details["P"][$keyP]["\120R\x4f\x44\125CTS\124OT\x41\x4c\x41\x46\x54E\x52\x44I\x53\103\x4f\x55\x4e\124\x53\125\x4d"] + $productvatsum;$Details["\x50"][$keyP]["\x50\122\x4fDU\x43\x54V\x41T\x50ERC\x45\116\124"] = $this->x1c($total_vat_percent);$Details["\120"][$keyP]["\x50R\x4f\x44\x55\103\x54V\x41\124SU\x4d"] = $this->x1c($productvatsum);$Details["\120"][$keyP]["\x50\122\117\104\x55\103T\x54\x4f\x54\x41\114\x53UM"] = $this->x1c($producttotalsum);} }else {if ($x10($vatblock) > 0){ foreach ($vatblock as $keyM => $valueM) $vat_value += $valueM["\x76\x61t"];}else{ $vat_value = "\060.00"; }} $shAmount = ($parent_focus->column_fields["hd\156\123\x5f\x48_\101\155o\165\156\164"] != "")?$parent_focus->column_fields["h\x64\x6eS_H\x5f\x41m\x6f\x75n\164"]:"\x30.0\060";$shtaxtotal = "0\x2e\x300";$shtax_details = getAllTaxes("a\166\x61\x69labl\x65","\x73h","\x65\144\x69\x74",$parent_focus->id);for($shtax_count=0;$shtax_count<$x10($shtax_details);$shtax_count++) {$shtax_name = $shtax_details[$shtax_count]["\164\141xnam\x65"];$shtax_label = $shtax_details[$shtax_count]["ta\170\x6c\141\142e\x6c"];$shtax_percent = getInventorySHTaxPercent($parent_id,$shtax_name);$shtaxamount = $shAmount*$shtax_percent/100;$shtaxtotal = $shtaxtotal + $shtaxamount;}$totalafterdiscount = $sumwithoutvat-$finalDiscount;$totalwithvat = ($sumwithoutvat-$finalDiscount)+$vat_value;$Details["\124\117\x54\101L"]["\x4e\105\x54T\117\x54\x41\x4c"] = $this->x1c($netTotal);$Details["\124\117\x54\101\114"]["\x54O\124\x41LW\x49\124HO\x55\124\126\101\124"] = $this->x1c($sumwithoutvat);$Details["\124\x4fT\x41L"]["\106\111\x4eA\114D\111SC\117UN\124"] = $this->x1c($finalDiscount);$Details["T\x4f\124\x41\x4c"]["\106I\116A\x4c\x44\x49\123\103\x4fUN\x54\x50\105RC\x45\x4e\124"] = $this->x1c($finalDiscountPercent);$Details["TO\124\x41L"]["\x54O\124A\x4c\101\x46\124\105\x52D\x49\123CO\125\x4e\124"] = $this->x1c($totalafterdiscount);$Details["\x54\x4fT\101\x4c"]["\x54\x41\x58\124\x4fT\x41\114"] = $this->x1c($vat_value);$Details["\124\117\124\x41\114"]["\124A\130T\x4f\124\101\x4c\120E\x52\x43EN\124"] = $this->x1c($total_vat_percent); $Details["\124\117\x54\101\x4c"]["T\x4f\124AL\127\x49\x54H\x56AT"] = $this->x1c($totalwithvat);$Details["\124\117\124\x41\114"]["S\110\x54A\x58AM\117U\116\x54"] = $this->x1c($shAmount);$Details["TO\x54\x41\x4c"]["S\110\124AXT\x4f\124\x41\x4c"] = $this->x1c($shtaxtotal);$Details["TO\x54A\114"]["\126\x41\124BLO\103\x4b"] = $vatblock;return $Details;}private function x15($id){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if(isset($id) AND $id!=""){$query="\x53EL\105\x43T\x20vt\x69\147\x65r_\141t\164a\x63h\155\145nts\056p\x61\164\x68, \166t\151g\x65r_atta\x63\150\155\x65\x6e\164s.n\141\155e\054 v\164\151\147e\162\137atta\x63h\155\x65nt\x73\x2e\141\164\x74\x61\143\150\155\x65\156ts\x69d\015\012\x20\040\x20 \040\x20 \040\x20\x20\x20 \x20 F\122\117\115 v\164\151g\x65r_\x63\x6f\x6e\x74\x61\x63t\x64\145\x74\141\x69\x6c\x73
  \x20  \040\040\x20\040\040\x20 \040\040\x49\x4eNE\122\040\x4a\x4fI\116\x20\166\164\151g\145\162_\163\145\x61\x74\164\x61\x63\x68me\x6e\164\163\x72\145l\015
\x20\x20\x20\040\040 \040\x20\x20\040\x20\040\x20\x20\x20\x20\117N \166\x74i\x67\145\162\137\x63\157\x6eta\x63\164d\145ta\151\154s.\x63\157n\x74\x61\143\x74\151\144\x3d\x76\x74iger\x5f\x73\145a\164\x74ac\150\x6d\145\x6ets\x72e\154\056\x63rm\151d\015\x0a\x20  \x20\x20\040\x20\040   \040\040 \111NN\x45R\x20JO\111N\x20\x76\x74\151ge\162_\141\164\x74\x61\143\x68\x6den\164s
\040\040\x20\040  \x20\x20 \x20\x20\x20 \x20 \040O\116\040\166tig\x65\162_a\164ta\143\150m\145nt\163.a\164\x74\141\x63\150\x6d\x65n\164\x73\151\x64\x3d\166\164ig\x65\162\x5f\163ea\x74\x74ac\150m\x65\156\164\163\162el\056\141\164\164ac\150me\x6e\x74s\151\x64\015\012\x20\040 \040\x20\040\040 \x20  \x20\x20\040\111NN\x45\122\x20\x4aOI\116 \166\x74i\147\145\162\137\x63\x72m\x65\156\164\x69\164\x79
\012\x20\040\040 \040\040\040\x20    \x20\040\x20\x20\117\116 vt\151\x67e\x72\x5f\141\164tac\x68m\x65nt\163\x2e\141\164\164\x61\143\x68m\x65n\164s\151\144=v\x74\151\147\145\162\137cr\x6d\145\x6e\164\151t\171\x2e\x63r\x6d\x69d
\012 \040\040\040\x20  \x20\x20 \x20  \040\127\110\x45R\x45 \x64el\145ted\x3d\x30\x20\101\x4e\104 \166\164\151g\x65\162\137\x63\x6f\156t\x61\143\164det\141\151\154s\x2e\143o\x6e\164a\143\x74i\x64\x3d\x3f";$result = $this->db->pquery($query, array($id));$num_rows = $this->db->num_rows($result);if ($num_rows > 0){$image_src = $this->db->query_result($result,0,"\x70a\x74\150").$this->db->query_result($result,0,"att\x61\143\150\155e\156\164s\151d")."\x5f".$this->db->query_result($result,0,"\x6ea\155\x65");$image = "\074\151m\x67\040\x73\162\x63='".$this->site_url."/".$image_src."'\x2f>";return $image;}} else {return "";}}private function x16($id){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if(isset($id) AND $id!=""){$sql = "\x73\145\154e\x63t\040\x76t\x69\147\145\x72_\x61t\x74\x61\x63h\x6d\x65n\x74s.*\x20\x66\162om\040\x76\164\151\147\x65\x72_a\164tach\x6d\145n\x74\x73\040\154\x65\146\x74\040\152\x6fi\156\040\166t\151\147er\x5fsa\154\145\x73\155\x61n\141\164\x74\141\x63\150\155e\156\x74\x73\x72\x65\154 \x6f\x6e\040\166\164iger\137s\141les\155\141\156\141t\164\141\x63hm\x65\156\x74srel.\x61\164\x74\141\x63h\x6d\145\x6ets\x69\x64\040\x3d vt\x69\x67\145\x72\137a\x74\x74ac\x68\x6den\164\x73.\141\164\x74a\x63h\x6den\x74\163\x69\144 \x77\x68\x65\x72e\x20v\x74ige\x72\137sa\154\x65sman\x61t\164\141c\x68\x6d\x65\156ts\x72e\x6c\056\x73\155\151\144=\077";$image_res = $this->db->pquery($sql, array($id));$image_id = $this->db->query_result($image_res, 0, 'attachmentsid');$image_path = $this->db->query_result($image_res, 0, 'path');$image_name = $this->db->query_result($image_res, 0, 'name');$imgpath = $image_path . $image_id . "\137" . $image_name;if ($image_name != '') {$image = '<img src="' . $imgpath . '" width="250px" border="0">';} else { $image = '';}return $image;} else {return "";}} private function x17($id) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($id != "") {$sql = "SEL\105C\x54\040\165se\162\x5f\156a\155\145 \106\122\x4fM\x20\166ti\x67\x65r_\x75\163\x65\x72s W\x48\x45R\x45 i\x64\075\x3f";$result = $this->db->pquery($sql, array($id));$ownername = $this->db->query_result($result,0,"use\162\137\156\x61m\145");}if($ownername == "") {$sql = "\x53ELEC\x54\x20\x67r\x6f\165\x70na\x6d\145 \x46\x52\x4f\x4d\x20v\164\x69g\145\162\137g\x72o\x75\160\163\x20\x57HE\x52\105 \x67\x72\157\x75pid\x3d\x3f";$result = $this->db->pquery($sql, array($id));$ownername = $this->db->query_result($result,0,"\147\162oupn\141\155e");}else {$ownername = getUserFullName($id);}return $ownername;}private function x18($account_id) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $accountno = "";if($account_id != '') {$sql = "\123E\x4cE\x43\124\040a\143\x63o\165\156\x74\137\156\157\040F\122OM\x20\x76\x74\151\147\145\x72\x5f\141\x63c\157\x75\x6e\164 \x57HERE\x20ac\x63\x6f\165\156t\x69d=\077";$result = $this->db->pquery($sql, array($account_id));$accountno = $this->db->query_result($result,0,"a\143\x63\157\x75\x6e\x74\137no");}return $accountno;}private function x19($str,$emodule) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($emodule!="\x50\162od\165\143\164\163/\x53\x65r\166ic\x65\x73") {$app_lang = return_application_language($this->language);$mod_lang = return_specified_module_language($this->language,$emodule);}else {$app_lang = return_specified_module_language($this->language,"\123\145r\166i\143\x65\163");$mod_lang = return_specified_module_language($this->language,"\x50ro\144\x75\x63\164\x73");}$trans_str = ($mod_lang[$str] != '') ? $mod_lang[$str] : (($app_lang[$str] != '') ? $app_lang[$str] : $str);return $trans_str;}private function x1a($module, $focus) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  $inventory_table = $this->inventory_table_array[$module];$inventory_id = $this->inventory_id_array[$module];$res = $this->db->pquery("SE\x4cE\x43\x54 c\165\x72\x72\x65\156\x63y\137\x69\x64\x2c\040".$inventory_table."\056\x63\157\x6e\166\x65\x72\163\x69\157\156\137ra\x74e\040AS\x20\x63o\156v\137ra\x74e,\040\166ti\x67\x65r\x5f\143\165\162\x72en\143\x79\137i\x6e\146\157.*
\012\x20\040\040  \040\x20\040\040 \040\040\x20 \040\040 \x20\040 \x20 \040 \040  \x46\x52\x4f\x4d ".$inventory_table."
 \040 \040  \040 \040\040    \040\x20\040  \x20\040  \x20 \x20\040I\x4e\x4eE\x52\040\112\117I\x4e v\164i\147\145\x72\137cu\x72\x72\145\156c\x79\137\151n\146\x6f\040\117\116 ".$inventory_table."\056\143\165\x72r\145\x6e\143\x79\137\x69\x64 \x3d v\x74ig\145r_\143urr\145\x6e\x63y\137\x69n\146\x6f.\151\144
\x20 \x20\x20\040\040\040\040 \x20\040\040\x20\040 \040 \040 \040\040\x20\040 \x20\040\x20W\x48\105\122\x45\x20".$inventory_id."=?", array($focus->id));$currency_info = array();$currency_info["\x63\x75r\162\x65\x6e\143\171\137i\144"] = $this->db->query_result($res,0,"cu\162re\156\x63\x79\137\x69\x64");$currency_info["\x63\157\x6eve\162\163\151o\x6e\x5fr\x61te"] = $this->db->query_result($res,0,"co\156\x76\x5f\162\141\164\x65");$currency_info["\x63u\162r\145\x6e\x63\x79\x5fn\x61m\145"] = $this->db->query_result($res,0,"\x63\165r\162\145\156c\x79_\156\x61\155\145");$currency_info["\x63\165r\x72\145\x6ec\x79\x5f\x63\157d\x65"] = $this->db->query_result($res,0,"c\x75\162r\145\156\143\171\137\143\157de");$currency_info["\x63u\162r\145n\143\171\137\163y\155\142\x6f\154"] = $this->db->query_result($res,0,"\143ur\x72en\143y\137sy\x6d\142\x6fl"); return $currency_info;}private function x1b($module, $focus) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $res = $this->db->pquery("\x53\x45\x4c\x45\x43\124\x20\x74a\170t\x79\160e\x20F\x52\x4f\115\040".$this->inventory_table_array[$module]."\x20WHE\122\x45\x20".$this->inventory_id_array[$module]."=?", array($focus->id));$taxtype = $this->db->query_result($res,0,'taxtype');return $taxtype;}private function x1c($value) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($x19($value)){$number = $x1d($value,$this->decimals,$this->decimal_point,$this->thousands_separator);}else {$number = "";}return $number;}private function x1d(&$focus,$record,$module) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $result = Array();foreach($focus->tab_name_index as $table_name=>$index)$result[$table_name] = $this->db->pquery("\123\105\114E\103\124 \052\x20\x46\122\117\x4d\040".$table_name."\x20\x57H\105\x52\105\040".$index."\075\077", array($record));$tabid = getTabid($module);$sql1 = "\123\105\x4c\x45CT\040\x66i\x65\154d\x6e\141\155\x65\x2c \x66i\145\x6cd\151\x64\x2c\x20\146ie\154\144\154\141\142el,\040\143\157l\165mn\156\141me\x2c\x20\164\141\x62le\156\141m\145\054 \x75\151\164\x79\160\x65\054\040t\x79\160\x65\157\146\144\141\164\x61\054\x20\x70\162\145\x73e\156c\145\x0d\x0a\040\040\x20\x20\040\040 \x20\040\040\040  \040\x20FR\x4fM\040\166t\x69\x67\x65\162\x5f\146\x69e\x6cd\040\x57\110\x45R\105\x20\x74a\x62\151d\x3d\077";$result1 = $this->db->pquery($sql1, array($tabid));$noofrows = $this->db->num_rows($result1);if($noofrows) {while($resultrow = $this->db->fetch_array($result1)) {$fieldcolname = $resultrow["\143\157\x6c\165\155\156\156\x61me"];$tablename= $resultrow["\x74\x61\x62\x6ce\156\141\x6d\145"];$fieldname= $resultrow["\x66i\x65\154\144\156a\x6d\145"];$fld_value="";if(isset($result[$tablename]))$fld_value = $this->db->query_result($result[$tablename],0,$fieldcolname);$focus->column_fields[$fieldname] = $fld_value;}}$focus->column_fields["rec\x6f\162\144\x5f\151\144"] = $record;$focus->column_fields["\x72\145\143or\x64\x5fm\157\x64\x75\154e"] = $module;}private function x1e($value) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($x13("m\x6f\x64\165l\x65\163\x2f\123\x65\164ti\x6eg\163\057\x45\144\151\164\124\145\x72m\x44e\164a\151l\x73.\160\x68p")) {$sql = "\123\105\114\x45CT\040t\x61\x6e\x64\143 F\x52\x4f\x4d \166\x74\151\x67\x65\x72\137in\166\145\156\x74\157r\171\x5f\164\x61\x6ed\143 \127H\105\122\x45\040\151\144='".$value."'";$res = $this->db->query($sql);$num = $this->db->num_rows($res);if($num>0)$tandc = $this->db->query_result($res,0,"t\x61\156dc");else$tandc = $value;}else$tandc = $value;return $tandc;}private function x1f($efocus) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $commentlist="";$prefix="";if($efocus->column_fields["\x72\145c\157rd_\x6d\x6f\x64ule"] == "H\145\154\x70\104e\163k"){$prefix="ti\x63\x6b\x65\164";}elseif($efocus->column_fields["r\145cord\x5f\x6dod\165l\145"] == "Fa\x71") {$prefix="\x66\141q";}if($prefix!="") {$mod_lang = return_specified_module_language($this->language,$efocus->column_fields["r\x65\x63\157r\x64_\155\157\144\165\x6ce"]);$sql="\123\x45\114\105C\x54\040\x2a\x20\106R\x4fM \166ti\147\x65\162\x5f".$prefix."co\x6d\155\145n\x74\163\040W\x48\x45R\x45 ".$prefix."\x69\x64=".$efocus->id;$result=$this->db->query($sql);while($row = $this->db->fetchByAssoc($result)) {$comment = $row["\143\x6fm\155e\156t\x73"];$crtime = getValidDisplayDate($row["c\x72\145\x61t\145\144t\x69\155\145"]);$body="";if($prefix=="ti\x63\x6be\x74"){$author = $this->x17($row["o\167ne\x72\x69\x64"]);$body=$comment."\x3cbr\x20\x2f>".$mod_lang["\x4cB\114_\101\x55T\x48OR"].":\040".$author."<\x62\162 \x2f\076".$mod_lang["\103r\145\x61\x74\145\144 \x54im\x65"]."\072 ".$crtime."<\142r\040\057\076\x3c\x62\162 \057>";}else {$body=$comment."\074b\162 /\x3e".$mod_lang["Cr\x65at\145\x64 Ti\x6de"]."\072\x20".$crtime."<\142r\040\x2f>\074br\040\057\x3e";}$commentlist.=$body;}}return $commentlist;}private function x20($folderid) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $sql="S\105\114E\103\124\x20f\x6fld\145\162n\141\155e\040\106ROM \166ti\x67e\x72\137\x61tta\x63\150\155en\x74\163\146old\145\162\040\x57\x48\x45R\x45\040\146\x6f\x6cd\145\x72\x69d=".$folderid;return $foldername = $this->db->query_result($this->db->query($sql),0,"fo\154d\x65\x72n\141\155e");}private function x21($after = ""){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($x19($x26($this->content, '[CUSTOMFUNCTION'.$x25($after).'|'))){ require_once("\143\154as\163es\x2f\x73\151m\160l\145\137\x68tm\x6c_\x64o\x6d\062\056\160\x68\x70");foreach ($x14('modules/EMAILMaker/functions/*.php') as $file) {include_once $file;} $this->replacements["\x5b\x43U\123\x54\117\x4dF\x55N\x43\124IO\116".$x25($after)."\x7c"]="<\x63\x75\163\x74o\155\146u\156\x63\164io\156".$x25($after).">"; $this->replacements["\x7cC\x55\123\124\x4f\x4d\106\125N\x43\124IO\x4e".$x25($after)."\x5d"]="\x3c/c\x75s\164\157\155func\x74\x69\x6f\156".$x25($after)."\076"; $this->x12(); $html = str_get_html2($this->content); foreach($html->find("\143\x75sto\x6d\x66\165\156c\164\x69\157\x6e".$after) as $customfunction) { $Params = $this->x22($x29($customfunction->plaintext));$func = $Params[0];unset($Params[0]);$replacement = $x0f($func,$Params);$customfunction->outertext = $replacement; } $this->content = $html->save(); } } private function x22($val){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $Params = array();$end = false;do {if ($x27($val, '|')) { if ($val[0] == '"'){$delimiter = '"|'; $val = $x28($val, 1); } elseif ($x28($val,0,6) == '&quot;'){$delimiter = '&quot;|'; $val = $x28($val, 6); } else$delimiter = '|';list($Params[],$val) = $x12($delimiter,$val,2);}else{ $Params[] = $val; $end = true;}} while (!$end);return $Params;}private function x23($val) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; return $x1b($val);} private function x24(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; include_once("mo\144ul\x65\163/E\115\101\111\x4cM\141ke\162\x2fE\x4dAI\x4cR\145l\x42\x6c\x6fc\153\122\165n\056\x70h\160");if($x26($this->content,"#\122ELB\x4cOC\113") !== false){$x1e("\174#R\105\114\x42LO\103K\050\133\x30\0559\x5d+\051\137\123T\101R\x54#\174\125", $this->content, $RelatedBlocks, PREG_PATTERN_ORDER);if ($x10($RelatedBlocks[1]) > 0){$ConvertRelBlock = array();foreach($RelatedBlocks[1] AS $r => $relblockid){if (!$x18($relblockid,$ConvertRelBlock)){$sql_rb = "S\x45\114E\x43\x54 \163e\x63\x6d\x6f\144u\154\145\040F\x52\x4f\115 \x76t\x69\147er\137em\x61ke\162\x74\x65m\160la\164\145\x73\137r\x65lbl\x6f\x63\153\x73\040\x57H\x45\122\x45 \x72\x65\154\142\154\157c\x6bi\x64 \075\040'".$relblockid."'";$secmodule = $this->db->query_result($this->db->query($sql_rb), 0, "s\145cm\x6fd\x75le");if($x26($this->content,"\x23R\105L\102LOC\x4b".$relblockid."\137\123\x54\x41R\x54\043") !== false){if ($x26($this->content,"\043\x52\x45L\x42\x4cOC\x4b".$relblockid."_E\116\104\x23") !== false){$tableDOM = $this->x25($relblockid);$oEmailRelBlockRun = new EmailRelBlockRun($this->focus->id, $relblockid, $this->module, $secmodule);$RelBlock_Data = $oEmailRelBlockRun->GenerateReport();$ExplodedEMAIL = array();$Exploded = $x12("\x23\x52\x45LBLO\103\x4b".$relblockid."_\123\124\x41\122\x54\043",$this->content);$ExplodedEMAIL[] = $Exploded[0];for($iterator=1;$iterator<$x10($Exploded);$iterator++){$SubExploded = $x12("#\122ELB\x4c\x4fCK".$relblockid."\137\x45N\104\043",$Exploded[$iterator]);foreach($SubExploded as $part)$ExplodedEMAIL[] = $part;$highestpartid = $iterator*2-1;$ProductParts[$highestpartid]=$ExplodedEMAIL[$highestpartid];$ExplodedEMAIL[$highestpartid]='';}if ($x10($RelBlock_Data) > 0) {foreach ($RelBlock_Data AS $RelBlock_i => $RelBlock_Details) {foreach($ProductParts as $productpartid=>$productparttext) {$show_line = false;foreach ($RelBlock_Details AS $coll => $value){if ($x29($value) != "\x2d") $show_line = true;$productparttext = $x21("$".$coll."$",$value,$productparttext);}if ($show_line) $ExplodedEMAIL[$productpartid].=$productparttext;}}}$this->content = $x17('',$ExplodedEMAIL);}}$ConvertRelBlock[] = $relblockid;}}}}}private function x25($relblockid) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; require_once("\x63l\141\x73\163\145\163\057s\x69m\x70\154\145\137\150\164\x6d\154\137\144\x6fm2.\x70\x68\x70");$html = str_get_html2($this->content);$tableDOM=false;foreach($html->find("\x74\x64") as $td){if($x29($td->plaintext) == "\043\122\x45\114BL\x4f\x43\113".$relblockid."\137S\x54\x41\x52\x54#"){$td->parent->outertext = "\x23R\x45\114BL\117\103\x4b".$relblockid."\x5f\x53\124AR\x54#";list($tag)=$x12("\076",$td->parent->parent->parent->outertext,2);$header = $td->parent->prev_sibling()->outertext;$header_style = $td->parent->prev_sibling()->children[0]->getAttribute("\x73\164\x79\154\145");$footer_tag="<\164\162\x3e"; if(isset($header_style)){ $StyleHeader = $x12("\073", $header_style);if(isset($StyleHeader)){ foreach($StyleHeader as $style_header_tag) {if($x26($style_header_tag, "\x62\x6fr\144e\162-\x74\157\x70") == TRUE){$footer_tag.="\074\164\x64 c\x6fl\x73\160\x61n='".$td->getAttribute("\x63o\154s\160\x61n")."' \x73t\171\154\145='".$style_header_tag."'\076\046\156\142\163\x70;\x3c\057\x74d\076";} }}} else {$footer_tag.="\074t\144\040c\157\x6cs\160a\156\075'".$td->getAttribute("co\154\x73\x70\x61\156")."' \163\164y\154e\075'\142or\x64e\x72\x2d\x74o\160\x3a\x31\160x\x20s\x6f\154\151\144\x20\043\0600\060\x30\x30\x30\073'\x3e\x26\156\x62\163\x70;\074\057t\144>";}$footer_tag.="<\057t\x72>";$var = $td->parent->next_sibling()->last_child()->plaintext;$subtotal_tr="";if($x26($var, "T\x4f\x54\x41\x4c")!==false){ if($x1a($td)){$style_subtotal=$td->getAttribute("\x73tyle");} if(isset($td->innertext)){list($style_subtotal_tag,$style_subtotal_endtag)=$x12("#PRO\x44\125C\124\102\x4cO\x43\x5f\123\x54\x41\122\124#",$td->innertext);} else {$style_subtotal_tag = "";$style_subtotal_endtag = "";}if(isset($style_subtotal)){$StyleSubtotal = $x12("\x3b", $style_subtotal); if(isset($StyleSubtotal)){ foreach($StyleSubtotal as $style_tag) {if($x26($style_tag, "\142\157\162\144\x65\x72-\164\x6fp") == TRUE){$tag.="\040\163ty\154e\075'".$style_tag."'";break;} } }} else {$style_subtotal = ""; } $tag.="\x3e";$subtotal_tr="\074tr\076";$subtotal_tr.="\074\164\144\x20\143\157\x6cs\x70a\156\x3d'".($td->getAttribute("co\154\163\x70an")-1)."' \163ty\154\x65\075'".$style_subtotal.";\x62\157rd\145\162\x2d\x72\151\x67h\164\x3a\x6e\x6fne'>".$style_subtotal_tag."%G_\x53u\142t\157\x74a\154%".$style_subtotal_endtag."<\x2f\164\x64\076";$subtotal_tr.="\074td\x20\141\154\151\147n\x3d'\x72\151g\x68\x74' n\x6f\167ra\160\075'\156o\167\162\141\160'\x20\x73\164\171\154e='".$style_subtotal."'\x3e".$style_subtotal_tag."".$x20($var,"$")."\137\123\125\102\x54O\124AL$".$style_subtotal_endtag."\074\057\164d>"; $subtotal_tr.="<\057t\x72\076"; }$tableDOM["\x74\141g"] = $tag; $tableDOM["he\x61\144e\162"] = $header; $tableDOM["f\157\x6f\164\145\162"] = $footer_tag; $tableDOM["sub\x74\x6ft\x61\154"] = $subtotal_tr;}if($x29($td->plaintext) == "\043R\x45\x4c\x42\114\x4f\103\113".$relblockid."\137E\116\x44#") $td->parent->outertext = "\043R\105\x4c\x42\114\x4f\x43\113".$relblockid."\x5f\x45\x4e\104\043";}$this->content=$html->save();return $tableDOM;}public function convertListViewBlock($content) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; require_once("\x63\154a\163\163es\x2f\x73\151\155\x70\154\x65\x5f\150\164\155\154\137\x64\x6fm\062.\x70\x68\x70");$html = str_get_html2($content);foreach($html->find("td") as $td){if($x29($td->plaintext) == "#\x4c\111STVI\x45\x57\102\x4cO\x43\113_\123T\x41\x52T#") $td->parent->outertext = "\043LI\123\x54\x56\111E\127BL\x4f\x43\x4b_STA\122\124#";if($x29($td->plaintext) == "\043\114\x49\123TV\111\105W\102L\x4f\x43K\137\x45\x4e\x44\x23") $td->parent->outertext = "\x23\x4c\111\123T\x56\111\105\127\102LO\x43\x4b\137E\116D#";}return $html->save();} private function x26() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $Clear_Modules = array("\101\143co\165\156\x74\163","\x43\x6f\156\x74a\x63\x74\163","\x56e\156\x64\x6fr\x73","\x4cea\x64s","\125se\162\163");foreach ($Clear_Modules AS $clear_module){$tabid1 = getTabId($clear_module);$field_inf = "_\146i\x65ld\x69\x6ef\157_\143ac\150e";$temp = &VTCacheUtils::$$field_inf;unset($temp[$tabid1]);$focus1 = CRMEntity::getInstance($clear_module);$this->replacements["\x24".$x24($clear_module)."\x2dcrm\151\144$"]="";$this->replacements["\x24"."\163\055".$x24($clear_module)."\x2d\x63\x72\x6d\151\x64\x24"]="";$this->x0e($clear_module, $focus1, "");$this->x0e($clear_module, $focus1, "\163\055");unset($focus1);}}private function x27($val) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; return $this->x23($val);} public function control() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  if ($this->type == "\x69\x6e\166\141\x6c\x69\144") {return false; } else {return true;}}private function x28($module, $focus, $prefix = ""){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if(!isset($this->inventory_table_array[$module]))return array();$IReplacements = array();$IReplacements["\x24".$prefix."\x53\125\102\124\x4f\x54\x41L\x24"] = $this->x1c($focus->column_fields["\x68\144\156\x53\165\x62T\157\164\141\154"]);$IReplacements["$".$prefix."\124O\124A\114$"] = $this->x1c($focus->column_fields["h\144\156\107\162\141\156d\x54ot\141\x6c"]);$currencytype = $this->x1a($module, $focus);$currencytype["\x63u\162r\x65\156c\x79\x5f\x73\171\155\x62ol"] = $x21("\303\xa2\xef¿\xbd\xc2\254","\x26\145\165ro;",$currencytype["\x63\x75\162\162\145\156c\171\x5f\163y\x6db\157\x6c"]);$currencytype["\x63\x75\x72\162e\156\143y\x5fs\171mb\x6f\x6c"] = $x21("\303\202\xc2\243","\046\160\x6f\165\x6e\144\073",$currencytype["cu\x72r\145n\x63\x79\137\x73y\155\142\x6f\x6c"]); $IReplacements["\044".$prefix."C\x55RR\x45\116\x43YN\101\x4d\105$"] = getTranslatedCurrencyString($currencytype["c\x75rre\x6e\143y_\156\x61\x6d\145"]);$IReplacements["\044".$prefix."\103U\x52R\105\116\x43\x59S\x59\x4d\102OL\x24"] = $currencytype["\x63urre\x6ec\171_sy\x6db\157\x6c"];$IReplacements["\044".$prefix."\x43\125\x52\122\x45N\x43\131\103O\104\x45$"] = $currencytype["cur\162\x65\x6e\x63\171\x5fc\157\x64\145"];$IReplacements["$".$prefix."\x41\x44J\x55\123TME\116\x54$"] = $this->x1c($focus->column_fields["\164\170\164\x41d\x6a\x75\163t\155e\x6et"]);$Products = $this->x14($module, $focus);$IReplacements["\x24".$prefix."\124\117TA\x4c\127\111T\110O\125\124\x56A\124\044"] = $Products["\x54\117\124\101L"]["T\117TA\114WIT\110\117\125\x54\x56AT"];$IReplacements["\x24".$prefix."\x56\x41\x54\x24"] = $Products["T\x4fTA\114"]["\x54\x41\130TO\124AL"];$IReplacements["\044".$prefix."\126\x41\124\x50\105R\x43\x45NT\044"] = $Products["\124\x4f\x54\101\x4c"]["T\101\130\x54\117\124\x41\x4c\x50ER\x43\x45N\124"];$IReplacements["\x24".$prefix."\124O\x54\x41L\x57I\124H\126\101\124$"] = $Products["\x54\117\124\x41\x4c"]["\124\x4f\x54\x41L\x57\x49\124\110V\x41\124"];$IReplacements["$".$prefix."SH\x54\x41\130\x41M\117\x55N\124$"] = $Products["\124O\124\101\x4c"]["\x53\110\x54AX\101\x4d\117U\x4eT"];$IReplacements["\x24".$prefix."\x53\x48\124A\130T\x4f\x54\101\x4c\x24"] = $Products["\124O\124\x41\114"]["\x53\x48\x54\101\130TO\124A\x4c"];$IReplacements["\044".$prefix."\124O\x54A\114\x44\111\123C\x4fU\116\124$"] = $Products["\124O\124A\x4c"]["\x46\111\x4eA\114\x44ISC\117U\x4eT"];$IReplacements["$".$prefix."\124\117\x54\x41\x4cDI\123\x43O\x55\116T\120\105\x52\x43\x45N\124\x24"] = $Products["\124\117\x54AL"]["\106I\116A\114\104\111\123CO\125\116\x54\x50\105\122\x43\x45N\x54"];$IReplacements["$".$prefix."T\117TAL\x41\106T\x45\122\x44\111\x53C\117\125N\x54\044"] = $Products["\x54\x4f\124A\x4c"]["\124OT\x41L\101\x46\x54\105\122\104I\x53C\x4fUN\124"];foreach ($IReplacements AS $r_key => $r_value){$this->replacements[$x24($r_key)] = $r_value;$this->replacements[$r_key] = $r_value;}$this->x12(); if($prefix == ""){ if ($x10($Products["T\117TA\x4c"]["\126A\124\x42L\x4f\103\113"]) > 0){$vattable = "<ta\x62\x6c\145 bo\162d\145\162\075'1'\040\163\x74yl\x65='b\157\162d\x65r\055co\x6c\154\x61\160\x73e\x3a\x63o\154\x6c\141\x70s\145\x3b' \x63\145l\154pa\x64d\x69\156\147='\x33'\x3e";$vattable .= "<\x74\162>
\012  \x20 \x20 \040\x20\x20\x20  \x20\040\040   \x20 \040 \040 \x20\040\x20  \040\x20 \x3c\x74\x64\x20n\x6f\167\x72a\x70\x20\x61l\x69\147n='\143\x65\x6et\x65\162'\076".$this->app_strings["\x4e\141me"]."<\057\164d>\015\012 \040\040\040\040\x20\x20\x20\040\x20\x20\x20\x20\040 \040 \040\x20\040\x20 \040  \040 \x20  \x20\x20<t\144\040\x6eo\167\x72\x61\160 \x61\154i\147\156\075'c\x65n\x74\x65r'>".$this->mod_strings["\114BL\x5f\126A\124\102\114\117\x43\x4b\137\126\x41\124\137\x50\105RC\x45\x4e\x54"]."\x3c/\x74\144\x3e
\012\040\x20\040\x20 \040\x20  \040 \040 \x20\x20\x20\x20\040\x20 \x20\x20\040\040 \x20\x20\040\040  \x20\074td now\x72\141\160\x20\x61\x6ci\147n\075'c\x65\156\x74\145\x72'\x3e".$this->mod_strings["\114\102\x4c_\x56A\x54BL\x4f\x43K\x5f\123\125\115"]." \050".$currencytype["curre\x6ec\x79\137\x73y\x6d\x62o\x6c"]."\051"."<\x2ft\144>
\x0a \x20 \x20\x20\040\x20\040\040 \x20 \040\x20 \040  \040 \x20\040\040\040 \040 \x20\040\040  <td\x20\x6e\157\167r\141p a\x6ci\x67\x6e='c\x65\156\x74\145\162'>".$this->mod_strings["\114BL_V\x41TB\114\x4f\x43K\x5fVAT_\x56A\x4c\x55\x45"]."\040\x28".$currencytype["\x63ur\x72\145\156cy\137s\171\x6db\157\x6c"].")"."\x3c/\164d\x3e\x0d\x0a\040\040\x20\040\x20\040 \040 \040 \040\040\x20\x20\040\040\040\x20\040\040\x20\040\x20 \040\040\040\040\x20\x3c/t\x72\x3e";foreach ($Products["\124OTA\114"]["VA\124B\114\117\x43\113"] as $keyW=>$valueW){if($valueW["\x6e\x65t\164\157"]!=0) {$vattable .= "<\164r\x3e\015\012\040\x20\x20\040 \040\040\040\x20 \040\x20 \040\040 \x20\x20  \040\x20\x20\040 \040 \x20\040\x20\040 \040 \x20 \040\040 \040\074td n\x6f\x77rap\040\141\x6c\x69g\x6e\075'\154\145\146t' \x77\x69dt\150='\0620%'\076".$valueW["\154\141\142\145\154"]."\x3c\x2f\164d>\x0d\x0a\040\x20 \040\x20 \x20  \040\x20\040\x20\x20\x20\x20\040\x20 \040 \040\040\040\011\x09\x09\x09\074\x74\x64\x20\156\x6fw\x72\141p \x61\154\x69\147\x6e\x3d'\x72\x69gh\x74'\040\x77\x69\x64\x74h\x3d'\062\x35\045'\x3e".$this->x1c($valueW["\166\x61\154\x75e"])." \045\074\057\164d\076
\012\040\x20\x20\040\040 \x20\040\x20\040  \040\040\040\040 \x20\040\040 \040\x20\x20   \x20\x20 \x20\040\x20\040\x20\040\040 \040\040\074\x74d\x20n\x6fw\162\x61p\x20\141\154\x69g\156\x3d'\162\151g\150t' \167idt\x68='3\x30%'\076".$this->x1c($valueW["\x6ee\164to"])."<\x2ftd\076\x0d\x0a\040\040 \x20\x20\040\x20 \x20\040\x20\x20\x20\040\x20\x20\x20\040 \x20     \x20 \x20\040\x20\x20\x20\x20\x20\040 \x20\x20  \x3ctd\x20\x6e\157\x77r\x61\160 a\154i\147\156\x3d'\x72\x69gh\164'\x20w\x69\x64th='25\x25'>".$this->x1c($valueW["\x76at"])."\074/\164\144\x3e\015
\040\x20\x20\040 \x20  \040\x20\x20\040  \x20  \040\x20 \x20 \x20 \x20    \x20\040\040  \040\040\x20\x20\074/\x74\x72\076";} }$vattable .= "\x3c\057tab\154e\x3e";}else{ $vattable = "";}$this->replacements["\x24"."\126\101T\x42\x4cO\103K\x24"] = $vattable;$this->x12(); if($x26($this->content,"\x23\x56A\124\x42\x4c\117CK\137\123\x54\x41\x52T#") !== false && $x26($this->content,"\x23V\x41\x54BL\117CK\137\105\116\104\x23") !== false){$this->convertVatBlock();$VExplodedPdf = array();$VExploded = $x12("#\126\x41\x54\102L\x4f\x43K\x5f\x53\124\101\x52\124\x23",$this->content);$VExplodedPdf[] = $VExploded[0];for($iterator=1;$iterator<$x10($VExploded);$iterator++){$VSubExploded = $x12("#\x56A\x54\102\114\117CK_E\116\x44#",$VExploded[$iterator]);foreach($VSubExploded as $Vpart){$VExplodedPdf[] = $Vpart;}$Vhighestpartid = $iterator*2-1;$VProductParts[$Vhighestpartid]=$VExplodedPdf[$Vhighestpartid];$VExplodedPdf[$Vhighestpartid]='';}if ($x10($Products["\x54\117\124\101L"]["\x56\x41\124B\114\x4f\x43K"]) > 0){foreach ($Products["TO\124A\x4c"]["VA\124\102L\x4fC\113"] as $keyW=>$valueW){foreach($VProductParts as $productpartid=>$productparttext){if($valueW["\156\145\x74t\x6f"]!=0){foreach($valueW as $vColl=>$vVal){if($x19($vVal))$vVal = $this->x1c($vVal);$productparttext = $x21("$"."\x56AT\102\114\117C\113\137".$x25($vColl)."$", $vVal, $productparttext);}$VExplodedPdf[$productpartid].=$productparttext;}}}}$this->content = $x17('',$VExplodedPdf);}}return $Products;}private function x29(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $tacModules = array();$tac4you = $x19(getTabId("\124a\143\064y\157\165"));if($tac4you == true) { $tacSql = "S\105\x4c\105\x43\124\x20\164e\170\x74 F\x52\x4f\x4d\x20\166t\151\x67e\162\137t\141\143\064\171\157u\x5f\x74ext\x73\x20WH\105R\x45\x20\x69\x64=\077"; $tacResult = $this->db->pquery($tacSql, array($this->focus->id)); $tacText = $this->db->query_result($tacResult, 0, "\x74\145\x78\x74"); $this->replacements["\x24"."s\x2d".$x24($this->module)."\137ta\143\x34\171\157\165\044"] = $x15($tacText, ENT_QUOTES, $this->def_charset);;} } private function x2a() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $desc4youModules = array();$desc4you = $x19(getTabId("D\x65s\143\162\151\160\164i\x6f\x6e\x73\064\171\x6f\165"));if($desc4you == true) { $descSql = "\123\x45L\105C\x54\x20t\x65x\164\040\106\122\117\115\x20\x76t\151\x67\145\162_\144\145\x73\143\x72\151\x70\164ions\064\171\x6f\165\137\164\x65x\x74\x73\040\127\x48\105R\105 \x69\x64\075?"; $descResult = $this->db->pquery($descSql, array($this->focus->id)); $descText = $this->db->query_result($descResult, 0, "t\x65\x78t"); $this->replacements["\044"."\163-".$x24($this->module)."\x5f\x64\145s\143\x34\171ou\x24"] = $x15($descText, ENT_QUOTES, $this->def_charset);;}}private function x2b(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $sql = "\123\105\x4c\105\103T \x76\145r\163i\157n_\164\171p\x65\x2c \154i\143\145n\x73e_\153e\x79\040F\x52\x4f\115 \x76\164\151g\145\x72\137e\155\141\153\145\x72\164\145m\x70\154\141\164\145s\137l\x69\143\145\156\163e";$result = $this->db->query($sql);if($this->db->num_rows($result) > 0) {$this->version_type = $this->db->query_result($result,0,"\166e\x72\163i\157\156\x5ft\171\x70\145");$this->license_key = $this->db->query_result($result,0,"\x6c\151\143e\156\163\x65\x5f\x6b\x65\171");}}}

function getEMAILContent($description, $id, $parent_type, $pid = '')
{
    global $adb,$log;

	$token_data_pair = explode('$',$description);
	global $current_user;
 	$emailTemplate = new EmailTemplate($parent_type, $description, $id, $current_user);
 	$description = $emailTemplate->getProcessedDescription();
 	$templateVariablePair = explode('$',$description);
 	$tokenDataPair = explode('$',$description);
	$fields = Array();
	for($i=1;$i < count($token_data_pair);$i+=2)
	{

		$module = explode('-',$tokenDataPair[$i]);
		$fields[$module[0]][] = $module[1];
	}
    if(is_array($fields['custom']) && count($fields['custom']) > 0){
    //Puneeth : Added for custom date & time fields
    $description = getMergedDescriptionCustomVars($fields, $description);
    }
    $log->debug("Exiting from getMergedDescription ...");
	return $description;
}
?>